

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>cutevariant.core.reader.abstractreader &mdash; Cutevariant  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="Cutevariant  documentation" href="../../../../index.html"/>
        <link rel="up" title="Module code" href="../../../index.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> Cutevariant
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html#development">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../command_line_usage.html">Command line usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev_documentation.html">Documentation for developers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Cutevariant</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>cutevariant.core.reader.abstractreader</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for cutevariant.core.reader.abstractreader</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">cutevariant.commons</span> <span class="k">as</span> <span class="nn">cm</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">logger</span><span class="p">()</span>


<div class="viewcode-block" id="AbstractReader"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader">[docs]</a><span class="k">class</span> <span class="nc">AbstractReader</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for all Readers required to import variants into the database.</span>

<span class="sd">    Subclass it if you want a new file parser .</span>

<span class="sd">    Attributes:</span>

<span class="sd">        device: A file object typically returned by open(); Can be None if</span>
<span class="sd">            FakeReader type is instanciated.</span>
<span class="sd">        file_size: File size in bytes</span>
<span class="sd">            See Also: :meth:`self.get_total_file_size`</span>
<span class="sd">        number_lines: Number of lines in the file (compressed or not).</span>
<span class="sd">            See Also: :meth:`self.compute_number_lines`</span>
<span class="sd">        read_bytes: Current bytes readed (progression = read_bytes / file_size)</span>
<span class="sd">            It&#39;s a fallback if number_lines can&#39;t be computed.</span>
<span class="sd">        samples: List of samples in the file (default: empty)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; with open(filename,&quot;r&quot;) as file:</span>
<span class="sd">        ...    reader = Reader(file)</span>
<span class="sd">        ...    reader.get_variants()</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AbstractReader.__init__"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_lines</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_bytes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_file_size</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_number_lines</span><span class="p">()</span></div>

<div class="viewcode-block" id="AbstractReader.get_variants"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader.get_variants">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_variants</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract method must return variants as an iterable of dictionnaries.</span>

<span class="sd">        Variant dictionnary has 4 mandatory fields `chr`, `pos`, `ref`, `alt`.</span>
<span class="sd">        Other fields are optionnal</span>
<span class="sd">        For instance::</span>

<span class="sd">            [</span>
<span class="sd">                {&quot;chr&quot;: &quot;chr3&quot;,&quot;pos&quot;: 3244,&quot;ref&quot;: &quot;A&quot;,&quot;alt&quot;:&quot;C&quot;, &quot;qual&quot;: 30},</span>
<span class="sd">                {&quot;chr&quot;: &quot;chr4&quot;,&quot;pos&quot;: 3244,&quot;ref&quot;: &quot;A&quot;,&quot;alt&quot;:&quot;C&quot;,&quot;qual&quot;: 20},</span>
<span class="sd">                {&quot;chr&quot;: &quot;chr5&quot;,&quot;pos&quot;: 3244,&quot;ref&quot;: &quot;A&quot;,&quot;alt&quot;:&quot;C&quot;,&quot;qual&quot;: 10 },</span>
<span class="sd">            ]</span>

<span class="sd">        Annotations and Samples objects can be embbeded into a variant dictionnaries.</span>
<span class="sd">        Annotations describes several annotations for one variant.</span>
<span class="sd">        In the most of the case, those are relative to transcripts.</span>
<span class="sd">        Samples describes information relative to a variant with a sample,</span>
<span class="sd">        like genotype (gt). This is a mandatory field.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            [{</span>
<span class="sd">                &quot;chr&quot;: &quot;chr3&quot;,</span>
<span class="sd">                &quot;pos&quot;: 3244,</span>
<span class="sd">                &quot;ref&quot;: &quot;A&quot;,</span>
<span class="sd">                &quot;alt&quot;:&quot;C&quot;,</span>
<span class="sd">                &quot;field_n&quot;: &quot;value_n&quot;,</span>
<span class="sd">                &quot;annotations&quot;: [</span>
<span class="sd">                    {&quot;gene&quot;: &quot;GJB2&quot;, &quot;transcripts&quot;: &quot;NM_00232.1&quot;, &quot;field_n&quot;: &quot;value_n&quot;},</span>
<span class="sd">                    {&quot;gene&quot;: &quot;GJB2&quot;, &quot;transcripts&quot;: &quot;NM_00232.2&quot;, &quot;field_n&quot;: &quot;value_n&quot;}</span>
<span class="sd">                ],</span>
<span class="sd">                &quot;samples&quot;: [</span>
<span class="sd">                    {&quot;name&quot;:&quot;boby&quot;, &quot;genotype&quot;: 1, &quot;field_n&quot;:&quot;value_n&quot;},</span>
<span class="sd">                    {&quot;name&quot;:&quot;kevin&quot;, &quot;genotype&quot;: 1, &quot;field_n&quot;:&quot;value_n&quot;}</span>
<span class="sd">                ]</span>
<span class="sd">            },]</span>

<span class="sd">        Yields:</span>
<span class="sd">            dict: variant dictionnary</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; for variant in reader.get_variants():</span>
<span class="sd">            ...     print(variant[&quot;chr&quot;], variant[&quot;pos&quot;])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractReader.get_fields"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader.get_fields">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract method hat must return fields description</span>

<span class="sd">        Full output::</span>

<span class="sd">            [</span>
<span class="sd">            {&quot;name&quot;: &quot;chr&quot;, &quot;type&quot;: &quot;text&quot;, &quot;category&quot;: &quot;variant&quot;, &quot;description&quot;: &quot;...&quot;},</span>
<span class="sd">            {&quot;name&quot;: &quot;pos&quot;, &quot;type&quot;: &quot;text&quot;, &quot;category&quot;: &quot;variant&quot;, &quot;description&quot;: &quot;...&quot;},</span>
<span class="sd">            {&quot;name&quot;: &quot;ref&quot;, &quot;type&quot;: &quot;text&quot;, &quot;category&quot;: &quot;variant&quot;, &quot;description&quot;: &quot;...&quot;},</span>
<span class="sd">            {&quot;name&quot;: &quot;alt&quot;, &quot;type&quot;: &quot;text&quot;, &quot;category&quot;: &quot;variant&quot;, &quot;description&quot;: &quot;...&quot;},</span>
<span class="sd">            {&quot;name&quot;: &quot;field_n&quot;, &quot;type&quot;: &quot;text&quot;, &quot;category&quot;: &quot;variant&quot;, &quot;description&quot;: &quot;...&quot;},</span>
<span class="sd">            {&quot;name&quot;: &quot;name&quot;, &quot;type&quot;: &quot;text&quot;, &quot;category&quot;: &quot;annotations&quot;, &quot;samples&quot;: &quot;...&quot;},</span>
<span class="sd">            {&quot;name&quot;: &quot;genotype&quot;, &quot;type&quot;: &quot;text&quot;, &quot;category&quot;: &quot;annotations&quot;, &quot;samples&quot;: &quot;...&quot;}</span>
<span class="sd">            ]</span>

<span class="sd">        Yields:</span>
<span class="sd">            dict: field dictionnary</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; for field in reader.get_fields():</span>
<span class="sd">            ...     print(field[&quot;name&quot;], field[&quot;description&quot;])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractReader.get_samples"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader.get_samples">[docs]</a>    <span class="k">def</span> <span class="nf">get_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return list of samples</span>

<span class="sd">        Override this method to have samples in sqlite database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="AbstractReader.get_metadatas"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader.get_metadatas">[docs]</a>    <span class="k">def</span> <span class="nf">get_metadatas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get meta data</span>

<span class="sd">        Override this method to have meta data in sqlite database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="AbstractReader.get_extra_fields"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader.get_extra_fields">[docs]</a>    <span class="k">def</span> <span class="nf">get_extra_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Yield fields with extra mandatory fields like &#39;comment&#39; and &#39;score&#39;&quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;favorite&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Tag status as favorite&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;comment&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Variant comment written by user&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;classification&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;ACMG score&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;count_hom&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of homozygous genotypes (1/1)&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;count_het&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of heterozygous genotypes (0/1)&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;count_ref&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of homozygous genotypes (0/0)&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;count_var&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of variants (not 0/0)&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;is_indel&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;True if variant is an indel&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;is_snp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;True if variant is a snp&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;annotation_count&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Count of transcripts per variant&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;case_count_hom&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of homozygous genotypes (1/1) in case&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;case_count_het&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of heterozygous genotypes (1/0) in case&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;case_count_ref&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of homozygous genotypes (0/0) in case&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;control_count_hom&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of homozygous genotypes (1/1) in control&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;control_count_het&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of heterozygous genotypes (1/0) in control&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">yield</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;control_count_ref&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;variants&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of homozygous genotypes (0/0) in control&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># avoid duplicates fields ...</span>
        <span class="n">duplicates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fields</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">field</span>

            <span class="n">duplicates</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="AbstractReader.get_extra_variants"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader.get_extra_variants">[docs]</a>    <span class="k">def</span> <span class="nf">get_extra_variants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Yield variants with extra information computed.</span>

<span class="sd">        The following information are added. See get_extra_fields</span>

<span class="sd">        - favorite (bool): (Default: False)</span>
<span class="sd">        - comment (str): (Default: &quot;&quot;)</span>
<span class="sd">        - classification (int): ACMG score (Default: 3 (uncertain significance)</span>
<span class="sd">        - count_var (int): Number of variants (not 0/0)</span>
<span class="sd">        - count_hom (int): How many variants are mutant homozygous within samples</span>
<span class="sd">        - count_het (int): How many variants are heterozygous within samples</span>
<span class="sd">        - count_ref (int): How many variants are wild homozygous with samples</span>
<span class="sd">        - is_indel (bool): Is the variation an insertion / deletion</span>
<span class="sd">        - is_snp (bool): Is the variation an single nucleotide variation</span>

<span class="sd">        If case/control are available from a pedfile, counting from case and</span>
<span class="sd">        control is also computed.</span>
<span class="sd">        In this case, it is necessary to give sample names in &quot;case&quot; and</span>
<span class="sd">        &quot;control&quot; keys in kwargs .</span>

<span class="sd">        Example of supported kwargs::</span>

<span class="sd">            {</span>
<span class="sd">                &quot;case&quot;: [&quot;boby&quot;, &quot;raymond&quot;],</span>
<span class="sd">                &quot;control&quot;: [&quot;lucas&quot;, &quot;pierre&quot;]</span>
<span class="sd">            }</span>

<span class="sd">        - case_count_hom (int): How many variants are mutant homozygous within case samples</span>
<span class="sd">        - case_count_het (int): How many variants are heterozygous within case samples</span>
<span class="sd">        - case_count_ref (int): How many variants are wild heterozygous within case samples</span>
<span class="sd">        - control_count_hom (int): How many variants are mutant homozygous within control samples</span>
<span class="sd">        - control_count_het (int): How many variants are heterozygous within control samples</span>
<span class="sd">        - control_count_ref (int): How many variants are wild heterozygous within control samples</span>

<span class="sd">        See Also:</span>
<span class="sd">            `cutevariant.core.reader.vcfreader.VcfReader.parse_variants`</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs (optional): case and control sample names</span>

<span class="sd">        Yields:</span>
<span class="sd">            (generator[dict]): variants. See also: :meth:`get_variants`.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AssertionError: If sample(s) are both in cases and controls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">case_and_control_samples_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;case&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s2">&quot;control&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># Samples can&#39;t be both in cases and controls</span>
            <span class="n">case_samples</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;case&quot;</span><span class="p">]</span>
            <span class="n">control_samples</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">]</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">case_samples</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">control_samples</span><span class="p">),</span> \
                <span class="s2">&quot;Found sample both in cases and controls!&quot;</span>
            <span class="n">case_and_control_samples_found</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">variant</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_variants</span><span class="p">():</span>
            <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;favorite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;classification&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

            <span class="c1"># For now set the first annotation as a major transcripts</span>
            <span class="k">if</span> <span class="s2">&quot;annotations&quot;</span> <span class="ow">in</span> <span class="n">variant</span><span class="p">:</span>
                <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;annotation_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variant</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">])</span>

            <span class="c1"># Count genotype by control and case</span>
            <span class="n">genotype_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;samples&quot;</span> <span class="ow">in</span> <span class="n">variant</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;samples&quot;</span><span class="p">]:</span>
                    <span class="n">genotype_counter</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;gt&quot;</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;count_hom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">genotype_counter</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;count_het&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">genotype_counter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;count_ref&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">genotype_counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Number of variants (not 0/0)</span>
            <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;count_var&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">genotype_counter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">genotype_counter</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;is_indel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variant</span><span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variant</span><span class="p">[</span><span class="s2">&quot;alt&quot;</span><span class="p">])</span>
            <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;is_snp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variant</span><span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">variant</span><span class="p">[</span><span class="s2">&quot;alt&quot;</span><span class="p">])</span>

            <span class="c1"># Count genotype by control and case</span>
            <span class="k">if</span> <span class="n">case_and_control_samples_found</span><span class="p">:</span>

                <span class="n">case_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
                <span class="n">control_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>

                <span class="k">if</span> <span class="s2">&quot;samples&quot;</span> <span class="ow">in</span> <span class="n">variant</span><span class="p">:</span>
                    <span class="c1"># Note: No garantee that samples from DB are all qualified</span>
                    <span class="c1"># by PED data.</span>
                    <span class="c1"># So some samples from variants may not be in case/control samples.</span>
                    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;samples&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">case_samples</span><span class="p">:</span>
                            <span class="n">case_counter</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;gt&quot;</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

                        <span class="k">elif</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">control_samples</span><span class="p">:</span>
                            <span class="n">control_counter</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;gt&quot;</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;case_count_hom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">case_counter</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;case_count_het&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">case_counter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;case_count_ref&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">case_counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;control_count_hom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">control_counter</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;control_count_het&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">control_counter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">variant</span><span class="p">[</span><span class="s2">&quot;control_count_ref&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">control_counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">yield</span> <span class="n">variant</span></div>

<div class="viewcode-block" id="AbstractReader.get_extra_fields_by_category"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader.get_extra_fields_by_category">[docs]</a>    <span class="k">def</span> <span class="nf">get_extra_fields_by_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Syntaxic suggar to get fields according their category</span>

<span class="sd">        :param category can be usually variants, samples, annotations</span>
<span class="sd">        :return: A generator of fields</span>
<span class="sd">        :rtype: &lt;generator&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extra_fields</span><span class="p">()</span> <span class="k">if</span> <span class="n">field</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">category</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="AbstractReader.get_fields_by_category"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader.get_fields_by_category">[docs]</a>    <span class="k">def</span> <span class="nf">get_fields_by_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Syntaxic suggar to get fields according their category</span>

<span class="sd">        :param category can be usually variants, samples, annotations</span>
<span class="sd">        :return: A generator of fields</span>
<span class="sd">        :rtype: &lt;generator&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span> <span class="k">if</span> <span class="n">field</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">category</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractReader.get_variants_count"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader.get_variants_count">[docs]</a>    <span class="k">def</span> <span class="nf">get_variants_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get variant count from the device</span>

<span class="sd">        Override this method to make it faster</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_variants</span><span class="p">()))</span></div>

<div class="viewcode-block" id="AbstractReader.get_total_file_size"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader.get_total_file_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_total_file_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compute file size int bytes&quot;&quot;&quot;</span>
        <span class="c1"># FakeReader is used ?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">cm</span><span class="o">.</span><span class="n">is_gz_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_uncompressed_size</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="c1"># Go to EOF and get position in bytes</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Rewind the file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">size</span></div>

<div class="viewcode-block" id="AbstractReader.compute_number_lines"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.AbstractReader.html#cutevariant.core.reader.abstractreader.AbstractReader.compute_number_lines">[docs]</a>    <span class="k">def</span> <span class="nf">compute_number_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a sample of lines in file if possible and if the end of file is</span>
<span class="sd">        not reached compute an evaluation of the global number of lines.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Nothing but sets `self.number_lines` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">find_lines_in_text_file</span><span class="p">(</span><span class="n">text_file_handler</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Get first 15000 lines</span>

<span class="sd">            PS: don&#39;t care of headers (# lines), the influence is marginal on big</span>
<span class="sd">            files and also on small files (so quick to insert that the wrong number</span>
<span class="sd">            of lines is invisible).</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">first_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15000</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">first_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">text_file_handler</span><span class="p">)))</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="c1"># EOF: exact number of lines is known</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">number_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_lines</span><span class="p">)</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_lines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_lines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_size</span> <span class="o">/</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">first_lines</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_lines</span><span class="p">))</span>
                <span class="p">)</span>

            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;nb lines evaluated: </span><span class="si">%s</span><span class="s2">; size: </span><span class="si">%s</span><span class="s2">; lines used: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_lines</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">first_lines</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="c1"># FakeReader is used ?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># Detect type of file handler</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">RawIOBase</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedIOBase</span><span class="p">)):</span>
            <span class="c1"># Binary opened file =&gt; assert that it is a vcf.gz file</span>
            <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_obj</span><span class="p">:</span>
                <span class="n">find_lines_in_text_file</span><span class="p">(</span><span class="n">file_obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOBase</span><span class="p">):</span>
            <span class="n">find_lines_in_text_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown file handler type: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unknown file handler type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>

        <span class="c1"># Rewind the file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="check_variant_schema"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.check_variant_schema.html#cutevariant.core.reader.abstractreader.check_variant_schema">[docs]</a><span class="k">def</span> <span class="nf">check_variant_schema</span><span class="p">(</span><span class="n">variant</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test if get_variant returns well formated nested data.</span>

<span class="sd">    This method is for testing purpose. It raises an exception if data is corrupted</span>

<span class="sd">    :param variant dict returned by AbstractReader.get_variant()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">schema</span> <span class="k">import</span> <span class="n">Schema</span><span class="p">,</span> <span class="n">And</span><span class="p">,</span> <span class="n">Or</span><span class="p">,</span> <span class="n">Use</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Regex</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;You should install optional package &#39;schema&#39; via:&quot;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> - pypi: pip install cutevariant[dev]&quot;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> - git repo in editable mode: pip -e . [dev]&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>

    <span class="n">checker</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;chr&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span><span class="n">Use</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">),</span> <span class="nb">str</span><span class="p">),</span>
            <span class="s2">&quot;pos&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span><span class="n">Use</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">),</span> <span class="n">Regex</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[ACGTN]+&quot;</span><span class="p">)),</span>
            <span class="s2">&quot;alt&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span><span class="n">Use</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">),</span> <span class="n">Regex</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[ACGTN]+&quot;</span><span class="p">)),</span>
            <span class="n">Optional</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span> <span class="n">Or</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">Optional</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">):</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;gene&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="s2">&quot;transcript&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">Optional</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span> <span class="n">Or</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="n">Optional</span><span class="p">(</span><span class="s2">&quot;samples&quot;</span><span class="p">):</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="s2">&quot;gt&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
                    <span class="n">Optional</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span> <span class="n">Or</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">checker</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">variant</span><span class="p">)</span></div>


<div class="viewcode-block" id="check_field_schema"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.check_field_schema.html#cutevariant.core.reader.abstractreader.check_field_schema">[docs]</a><span class="k">def</span> <span class="nf">check_field_schema</span><span class="p">(</span><span class="n">field</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test if get_field returns well formated data</span>

<span class="sd">    This method is for testing purpose. It raises an exception if data is corrupted</span>

<span class="sd">    :param field dict returned by AbstractReader.get_field()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">schema</span> <span class="k">import</span> <span class="n">Schema</span><span class="p">,</span> <span class="n">And</span><span class="p">,</span> <span class="n">Use</span><span class="p">,</span> <span class="n">Optional</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;You should install optional package &#39;schema&#39; via:&quot;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> - pypi: pip install cutevariant[dev]&quot;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> - git repo in editable mode: pip -e . [dev]&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>

    <span class="n">checker</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Use</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">)),</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">],</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;variants&quot;</span><span class="p">,</span> <span class="s2">&quot;annotations&quot;</span><span class="p">,</span> <span class="s2">&quot;samples&quot;</span><span class="p">],</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">Optional</span><span class="p">(</span><span class="s2">&quot;constraint&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;NULL&quot;</span><span class="p">):</span> <span class="nb">str</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">checker</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">field</span><span class="p">)</span></div>


<div class="viewcode-block" id="sanitize_field_name"><a class="viewcode-back" href="../../../../_autosummary/cutevariant.core.reader.abstractreader.sanitize_field_name.html#cutevariant.core.reader.abstractreader.sanitize_field_name">[docs]</a><span class="k">def</span> <span class="nf">sanitize_field_name</span><span class="p">(</span><span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="c1"># TODO</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;NOT implemented function!!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">field</span></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2020, labsquare.org.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>